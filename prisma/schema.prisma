generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String   @id @default(uuid())
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  email                 String   @unique
  contactEmail          String?
  password              String?
  firstName             String?
  lastName              String?
  age                   Int?
  profileImage          String?
  smoker                Boolean?
  pets                  Boolean?
  budgetMax             Int?
  propertyId            String?
  emailVerificationCode String   @unique
  emailVerified         Boolean  @default(true)
  profileVisible        Boolean  @default(false)
  provider              String?
  providerAccountId     String?
  passwordResetCode     String?  @unique
  bgImage               String?
  description           String?
  gender                String?
  moodboardImages       String[]
  phone                 String?
  city                  String?
  districts             String[]
  searchAmount          String?

  interests           String[] @default([])
  occupations         String[] @default([])
  searchPreferences   String[] @default([])
  searchPropertyTypes String[] @default([])
  noiseCompatibility  String[] @default([])
  petsCompatibility   String[] @default([])

  messagesReceived Message[]  @relation("MessagesReceived")
  messagesSent     Message[]  @relation("MessagesSent")
  properties       Property[]

  roommateInProperties Property[] @relation("PropertyRoommates")

  bookmarkedProperties PropertyBookmark[] @relation("UserPropertyBookmarks")
  bookmarkedByUsers    UserBookmark[]     @relation("BookmarkTargetUser")
  bookmarkedUsers      UserBookmark[]     @relation("BookmarkOwnerUser")

  reportsFiled   Report[] @relation("ReportsFiled")
  reportsAgainst Report[] @relation("ReportsAgainstUser")
}

model Property {
  id              String         @id @default(uuid())
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  type            String?
  listingType     ListingType
  status          PropertyStatus @default(DRAFT)
  title           String
  description     String?
  price           Int
  deposit         Int?
  city            String
  district        String?
  street          String?
  buildingNumber  String?
  latitude        Float?
  longitude       Float?
  sizeM2          Int?
  rooms           Int?
  floor           Int?
  yearBuilt       Int?
  furnished       Boolean?
  balcony         Boolean?
  elevator        Boolean?
  parking         Boolean?
  petsAllowed     Boolean?
  smokingAllowed  Boolean?
  internet        Boolean?
  tv              Boolean?
  washingMachine  Boolean?
  dishwasher      Boolean?
  airConditioning Boolean?
  isShared        Boolean?       @default(false)
  roomType        String?
  images          String[]
  mainImageIdx    Int?
  ownerId         String
  email           String?
  phone           String?
  owner           User           @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  roommates       User[]         @relation("PropertyRoommates")

  bookmarkedBy PropertyBookmark[] @relation("PropertyBookmarks")

  reports Report[] @relation("ReportsAgainstProperty")
}

model PropertyBookmark {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  userId     String
  propertyId String

  user     User     @relation("UserPropertyBookmarks", fields: [userId], references: [id], onDelete: Cascade)
  property Property @relation("PropertyBookmarks", fields: [propertyId], references: [id])

  @@unique([userId, propertyId])
}

model UserBookmark {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  userId   String
  targetId String

  user   User @relation("BookmarkOwnerUser", fields: [userId], references: [id], onDelete: Cascade)
  target User @relation("BookmarkTargetUser", fields: [targetId], references: [id], onDelete: Cascade)

  @@unique([userId, targetId])
}

model Message {
  id         String   @id @default(uuid())
  createdAt  DateTime @default(now())
  content    String
  senderId   String
  receiverId String
  receiver   User     @relation("MessagesReceived", fields: [receiverId], references: [id], onDelete: Cascade)
  sender     User     @relation("MessagesSent", fields: [senderId], references: [id], onDelete: Cascade)
}

model Report {
  id          String       @id @default(uuid())
  createdAt   DateTime     @default(now())
  reason      ReportReason
  description String?

  reporterId String
  reporter   User   @relation("ReportsFiled", fields: [reporterId], references: [id], onDelete: Cascade)

  reportedUserId String?
  reportedUser   User?   @relation("ReportsAgainstUser", fields: [reportedUserId], references: [id])

  reportedPropertyId String?
  reportedProperty   Property? @relation("ReportsAgainstProperty", fields: [reportedPropertyId], references: [id])
}

enum ReportReason {
  SPAM
  SCAM
  INAPPROPRIATE_BEHAVIOR
  FAKE_PROFILE
  MISLEADING_INFORMATION
  OTHER
}

enum PropertyStatus {
  DRAFT
  ACTIVE
  RESERVED
}

enum ListingType {
  SALE
  RENT
}
